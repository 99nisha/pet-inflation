library(dplyr)
library(lubridate)
library(forecast)

# Convert dataset to base data frame
df <- as.data.frame(dataset)

# Keep only Source = "CPI"
df <- df %>% filter(Source == "CPI")

# Convert Year to numeric safely
df$Year <- as.numeric(as.character(df$Year))

# Convert Month to numeric:
# If Month is text like "Jan", "Feb", use match()
if(is.character(df$Month) || is.factor(df$Month)) {
  month_names <- month.abb   # "Jan", "Feb", ..., "Dec"
  df$Month <- match(substr(as.character(df$Month),1,3), month_names)
}

# Create proper Date column
df$Date <- make_date(df$Year, df$Month, 1)

# Filter for date range
filtered_data <- df %>%
  filter(Date >= as.Date("2016-01-01") & Date <= as.Date("2024-12-31"))

# Check
if(nrow(filtered_data) == 0) stop("No rows after filtering. Check Year/Month columns!")

# Convert to monthly ts object
ts_data <- ts(filtered_data$Value,
              start = c(2016, 1),
              frequency = 12)

# STL decomposition
decomp <- stl(ts_data, s.window = "periodic")

# Plot
plot(decomp)
